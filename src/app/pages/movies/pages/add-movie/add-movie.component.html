<div *ngIf="!isUpdate || (isUpdate && movie); else noResponseYet">
    <form class="form-movie"
          #movieForm="ngForm" 
          (ngSubmit)="saveMovie()"
          autocomplete="off" 
          fxLayout="column" fxFlex="100%" 
          fxFlexOffset.gt-md="30%" fxFlex.gt-md="40%"
          fxFlex.gt-lg="33.3%" fxFlexOffset.gt-lg="33.3%">

        <mat-form-field class="form-movie__field" appearance="fill">
            <mat-label>{{CONST.MOVIE_TITLE_LABEL | translate}}</mat-label>
            <input matInput 
                   type="text"  
                   name="movieTitle" 
                   [(ngModel)]="movie.title"
                   required>
            <mat-error *ngIf="movieForm?.controls?.['movieTitle']?.errors?.['required']">
                Este campo es obligatorio. MOVER A CONSTANTES Y TRADUCCION
            </mat-error>
        </mat-form-field>

        <mat-form-field class="form-movie__field" appearance="fill">
            <mat-label>{{CONST.MOVIE_POSTER_LABEL | translate}}</mat-label>
            <input matInput 
                   type="url" 
                   name="moviePoster" 
                   [(ngModel)]="movie.poster"
                   [pattern]="urlPattern"
                   (blur)="validateUrlField('moviePoster')">
            <mat-error *ngIf="urlPatternFieldValid">
                La URL no es correcta. Debe comenzar por http:// ó https://. MOVER A CONSTANTES Y TRADUCCION
            </mat-error>
        </mat-form-field>

        <mat-form-field class="form-movie__field" appearance="fill">
            <mat-label>{{CONST.MOVIE_GENRE_LABEL | translate}}</mat-label>
            <mat-select multiple name="movieGenres" [(ngModel)]="movie.genres">
                <mat-select-trigger>
                    <mat-chip-list>
                        <mat-chip *ngFor="let genre of movie.genres" 
                                  removable 
                                  (removed)="removeGenreChip(genre)">
                            {{genre}}
                            <mat-icon matChipRemove>cancel</mat-icon>
                        </mat-chip>
                    </mat-chip-list>
                </mat-select-trigger>
                <mat-option *ngFor="let genre of genresList" [value]="genre">
                    {{genre}}
                </mat-option>
            </mat-select>
        </mat-form-field>

        <mat-form-field class="form-movie__field" appearance="fill">
            <mat-label>{{CONST.MOVIE_ACTORS_LABEL | translate}}</mat-label>
            <mat-select multiple 
                        name="movieActors" 
                        [(ngModel)]="movie.actors">
                <mat-select-trigger>
                    <mat-chip-list>
                        <mat-chip *ngFor="let actor of movie.actors" 
                                  removable 
                                  (removed)="removeActorChip(actor)">
                            {{actor.first_name}}&nbsp;{{actor.last_name}}
                            <mat-icon matChipRemove>cancel</mat-icon>
                        </mat-chip>
                    </mat-chip-list>
                </mat-select-trigger>
                <mat-option *ngFor="let actor of actorsList" [value]='actor'>
                    {{actor.first_name}}&nbsp;{{actor.last_name}}
                </mat-option>
            </mat-select>
        </mat-form-field>

        <mat-form-field class="form-movie__field" appearance="fill">
            <mat-label>{{CONST.MOVIE_COMPANY_LABEL | translate}}</mat-label>
            <mat-select name="movieCompany" 
                        [(ngModel)]="movie.company">
                <mat-select-trigger>
                    <mat-chip-list>
                        <mat-chip *ngIf="movie.company" 
                                  removable 
                                  (removed)="removeCompanyChip()">
                            {{movie.company.name}}
                            <mat-icon matChipRemove>cancel</mat-icon>
                        </mat-chip>
                    </mat-chip-list>
                </mat-select-trigger>
                <mat-option *ngFor="let company of companiesList" 
                            [value]='company'>
                    {{company.name}}
                </mat-option>
            </mat-select>
        </mat-form-field>

        <mat-form-field class="form-movie__field" appearance="fill">
            <mat-label>{{CONST.MOVIE_YEAR_LABEL | translate}}</mat-label>
            <input matInput 
                   type="number" 
                   name="movieYear" 
                   [(ngModel)]="movie.year"
                   required
                   min="1895" [max]="getCurrentYear()"
                   (blur)="validateNumericField('movieYear')"> 
            <mat-error *ngIf="movieForm?.controls?.['movieYear']?.errors?.['required']">
                Este campo es obligatorio. MOVER A CONSTANTES Y TRADUCCION
            </mat-error>
            <mat-error *ngIf="numericFieldMinValid">
                No había películas antes de 1885. MOVER A CONSTANTES Y TRADUCCION
            </mat-error>
            <mat-error *ngIf="numericFieldMaxValid">
                El año no puede ser superior al actual: {{getCurrentYear()}}  MOVER A CONSTANTES Y TRADUCCION
            </mat-error>
        </mat-form-field>

        <mat-form-field class="form-movie__field" appearance="fill">
            <mat-label>{{CONST.MOVIE_DURATION_LABEL | translate}}</mat-label>
            <input matInput 
                   type="number"
                   name="movieDuration" 
                   [(ngModel)]="movie.duration"
                   required
                   min="0" max="1260"
                   (blur)="validateNumericField('movieDuration')">
            <mat-error *ngIf="movieForm?.controls?.['movieDuration']?.errors?.['required']">
                Este campo es obligatorio. MOVER A CONSTANTES Y TRADUCCION
            </mat-error>
            <mat-error *ngIf="numericFieldMinValid">
                La duración no puede ser menor que 0. MOVER A CONSTANTES Y TRADUCCION
            </mat-error>
            <mat-error *ngIf="numericFieldMaxValid">
                La película más larga que existe dura 1260 minutos. MOVER A CONSTANTES Y TRADUCCION
            </mat-error>
        </mat-form-field>

        <mat-form-field class="form-movie__field" appearance="fill">
            <mat-label>{{CONST.MOVIE_RATING_LABEL | translate}}</mat-label>
            <input matInput 
                   type="number" 
                   name="movieRating" 
                   [(ngModel)]="movie.imdbRating"
                   required
                   min="0" step="0.1" max="10"
                   (blur)="validateNumericField('movieRating')">
            <mat-error *ngIf="movieForm?.controls?.['movieRating']?.errors?.['required']">
                Este campo es obligatorio. MOVER A CONSTANTES Y TRADUCCION
            </mat-error>
            <mat-error *ngIf="numericFieldMinValid">
                La valoración no puede ser menor que 0. MOVER A CONSTANTES Y TRADUCCION
            </mat-error>
            <mat-error *ngIf="numericFieldMaxValid">
                La valoración no puede ser mayor que 10. MOVER A CONSTANTES Y TRADUCCION
            </mat-error>
        </mat-form-field>

        <div class="save-button">
            <button mat-fab color="accent" 
                    type="submit">
                <mat-icon>save</mat-icon>
            </button>
        </div>

        <!-- TESTS -->
        <pre><span>FORM Valid -> </span>{{movieForm.valid | json}}</pre>
        <pre><span>FORM Pristine -> </span>{{movieForm.pristine | json}}</pre>
        <pre><span>FORM Touched -> </span>{{movieForm.touched| json}}</pre>
        <pre><span>FORM Value -> </span>{{movieForm.value | json}}</pre>

    </form>
</div>

<ng-template #noResponseYet>
    <app-spinner></app-spinner>
</ng-template>


